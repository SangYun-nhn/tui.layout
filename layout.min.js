/*!component-layout v1.0.0 | NHN Entertainment*/
!function(){var a={MOVEBUTTON:'<button class="move-button drag-item-move" data-item="{{item-id}}">move</button>',ELEMENT:'<div class="item" data-index="{{number}}"><div class="{{wrapper}}"></div></div>',TITLE:'<div class="title"></div>',TOGGLEBUTTON:'<button class="toggle-button">toggle</button>',GROUP:'<div class="group gp_{{group-id}}" data-group="{{group-id}}"></div>',GUIDE:'<div class="item-guide"></div>'},b={DEFAULT_TITLE:"no title"},c={OPTIONS_NOT_DEFINED:"options are not defined"},d="item-body",e="dimmed-layer";ne.util.defineNamespace("ne.component"),ne.component.Layout=ne.util.defineClass({init:function(a,b){this.$element=b,this._makeGroup(a.grouplist),this._makeGuide(a.guideHTML),this._setEvents()},_makeGroup:function(a){var b;this.groups={},ne.util.forEach(a,function(a){b=this.groups[a.id]=new ne.component.Layout.Group(a),this.$element.append(b.$element)},this)},_getGroup:function(a){return ne.util.isObject(a)&&(a=a.attr("data-group")?a.attr("data-group"):a.parent().attr("data-group")),this.groups[a]},_makeGuide:function(a){this._guide=new ne.component.Layout.Guide({guideHTML:a})},_setEvents:function(){this.onMouseDown=$.proxy(this._onMouseDown,this),this.onMouseMove=$.proxy(this._onMouseMove,this),this.onMouseUp=$.proxy(this._onMouseUp,this),$(".drag-item-move").on("mousedown",this.onMouseDown)},_onMouseDown:function(a){var b=$(document);this.height(b.height()),this._setGuide(a.target,a.clientX,a.clientY),b.on("mousemove",this.onMouseMove),b.on("mouseup",this.onMouseUp)},_setGuide:function(a,b,c){var d=$(document),e={x:b+d.scrollLeft()+10,y:c+d.scrollTop()+10},f=$(a).attr("data-item"),g=$("#"+f);this._guide.ready(e,g),this._guide.setMoveElement(g),this.$temp=g,this._lockTemp()},_lockTemp:function(){var a=this._getGroup(this.$temp),b=a.list[this.$temp.attr("data-index")];this.$temp.css("opacity","0.2"),this.$temp.find("#"+b.contentId).css("visibility","hidden")},_unlockTemp:function(){var a=this._getGroup(this.$temp),b=a.list[this.$temp.attr("data-index")];this.$temp.css("opacity","1"),this.$temp.find("#"+b.contentId).css("visibility","visible")},_onMouseMove:function(a){var b,c,d,e,f;b=$(a.target).parent(),c=$(document),d=a.clientX+c.scrollLeft(),e=a.clientY+c.scrollTop(),f=b.attr("data-group"),this._setScrollState(d,e),this._moveGuide(d,e),f&&this._detectMove(b,d,e)},_setScrollState:function(a,b){var c=$(document),d=$(window),e=this.height(),f=d.height(),g=c.scrollTop(),h=e-f;b>f+g&&c.scrollTop(Math.min(g+(b-f+g),h))},height:function(a){return ne.util.isUndefined(a)?this._height:void(this._height=a)},_detectMove:function(a,b,c){var d,e=$(document),f=this._getGroup(a),g=(a.attr("data-group"),e.scrollTop()),h=e.scrollLeft();ne.util.isEmpty(f.list)?(a.append(this.$temp),this.height(e.height()),this.$temp.way="after",this.$temp.index=0):(d=this._detectTargetByPosition({x:b+h,y:c+g},f),d&&d.way&&(d[d.way](this.$temp),this.height(e.height()),this.$temp.way=d.way,this.$temp.index=d.attr("data-index")))},_moveGuide:function(a,b){this._guide.moveTo({x:a+10+"px",y:b+10+"px"})},_detectTargetByPosition:function(a,b){var c;return ne.util.forEach(b.list,function(d){this._isValidItem(d)&&(c=this._getTarget(d,a,b)||c)},this),c},_getTarget:function(a,b,c){var d,e=a.$element.offset(),f=this._getBottom(a,c),g=a.$element.height(),h=$(document).scrollTop()+e.top;return b.y>h&&b.y<=h+g/2?(d=a.$element,d.way="before"):b.y>h+g/2&&b.y<f&&(d=a.$element,d.way="after"),d},_isValidItem:function(a){return a.$element[0]!==this.$temp[0]},_getBottom:function(a,b){var c,d=a.$element.next(),f=$(document),g=b.$element.offset(),h=f.scrollTop()+g.top+b.$element.height();return c=d.hasClass(e)?h:f.scrollTop()+d.offset().top},_getAddIndex:function(){var a=this.$temp,b=parseInt(a.index,10);return"after"===a.way&&(b+=1),b},_onMouseUp:function(a){var b=this._guide,c=$(document),d=this._getGroup(this.$temp.attr("data-groupInfo"));this._detectTargetByPosition({x:a.clientX+c.scrollLeft(),y:a.clientY+c.scrollTop()},d);this._update(),this._unlockTemp(),b.finish(),c.off("mousemove",this.onMouseMove),c.off("mouseup",this.onMouseUp)},_update:function(){var a=this.$temp,b=this._getGroup(a.attr("data-groupInfo")),c=this._getGroup(a.parent()),d=parseInt(a.attr("data-index"),10),e=this._getAddIndex(),f=b.list[d];isNaN(e)||(b.storePool(),c.storePool(),b.remove(d),c.add(f,e),c.render(),b.render())}}),ne.util.defineNamespace("ne.component.Layout"),ne.component.Layout.Group=ne.util.defineClass({$pool:$('<div class="pool" style="display:none"></div>'),init:function(b){if(!b)throw new Error(c.OPTIONS_NOT_DEFINED);this.size=b.ratio+"%",this.id=b.id,this._makeElement(b.html||a.GROUP),this._makeItems(b.items),this._appendDimmed(),this.render()},_makeElement:function(a){a=this._getHtml(a,{"group-id":this.id}),this.$element=$(a),this.$element.css({position:"relative",width:this.size})},_getHtml:function(a,b){return a=a.replace(/\{\{([^\}]+)\}\}/g,function(a,c){return b[c]})},_makeItems:function(a){var b={groupInfo:this.id};this.list=ne.util.map(a,function(a){return ne.util.extend(a,b),new ne.component.Layout.Item(a)},this)},_makeDimmed:function(){this.$dimmed=$('<div class="'+e+'"></div>'),this.$dimmed.css({position:"absolute",left:0,top:0,bottom:0,right:0,display:"none"})},_appendDimmed:function(){this.$dimmed||this._makeDimmed(),this.$element.append(this.$dimmed)},remove:function(a){this.storePool(this.list[a]),this.list.splice(a,1)},add:function(a,b){arguments.length>1?this.list.splice(b,0,a):this.list.push(a),a.groupInfo=this.id},render:function(){ne.util.forEach(this.list,function(a,b){this.$dimmed.before(a.$element),a.index=b,a.$element.attr({"data-index":b,"data-groupInfo":this.id})},this),this.$dimmed.hide()},storePool:function(a){a?this.$pool.append(a):ne.util.forEach(this.list,function(a){this.$pool.append(a.$element)},this)}}),ne.util.defineNamespace("ne.component.Layout"),ne.component.Layout.Guide=ne.util.defineClass({init:function(b){b=b||{},this.$element=$(b.guideHTML||a.GUIDE),this.$element.css("position","absolute"),this.$element.appendTo(document.body),this.$dimElements=$("."+e),this.hide()},ready:function(a,b){this.setPos(a),this.$dimElements.show(),b&&this.setContent(b),this.$element.show()},finish:function(){this.$dimElements.hide(),this.$element.hide()},moveTo:function(a){this.setPos(a)},setPos:function(a){this.$element.css({left:a.x,top:a.y})},setContent:function(a){this.$element.empty(),this.$element.append(a.clone()),this.$element.css({width:a.width()+"px",height:a.height()+"px"})},show:function(){this.isDisable||this.$element.show()},hide:function(){this.$element.hide()},disable:function(){this.isDisable=!0},enable:function(){this.isDisable=!1},setMoveElement:function(a){this.$moveElement=a},getScrollLeft:function(){return window.scrollX||$(window).scrollLeft()},getScrollTop:function(){return window.scrollY||$(window).scrollTop()}}),ne.util.defineNamespace("ne.component.Layout"),ne.component.Layout.Item=ne.util.defineClass({init:function(d){if(!d)throw new Error(c.OPTIONS_NOT_DEFINED);ne.util.extend(d,{elementHTML:d.elementHTML||a.ELEMENT,moveButtonHTML:d.moveButtonHTML||a.MOVEBUTTON,titleHTML:d.titleHTML||a.TITLE,toggleButtonHTML:d.toggleButtonHTML||a.TOGGLEBUTTON,title:d.title||b.DEFAULT_TITLE}),ne.util.extend(this,d),this._makeElement(),ne.util.isBoolean(this.isClose)||this.fixTitle(),this.isClose?this.close():this.open(),this.$content.append($("#"+this.contentId)),this.$element.attr("id","item_id_"+this.contentId),this._setEvents()},getIndex:function(){return this.index},_makeElement:function(){var a=this.wrapperClass||d,b=this._getHtml(this.elementHTML,{number:this.index,wrapper:a});this.$element=$(b),this.$element.css("position","relative"),this.$content=this.$element.find("."+a),this.isDraggable=!!this.isDraggable,this._makeTitle()},_makeTitle:function(){this.$titleElement=$(this.titleHTML),this.$titleElement.html(this.title),this.isDraggable&&this._makeDragButton(this.moveButtonHTML),this.$content.before(this.$titleElement),this._makeToggleButton(this.toggleButtonHTML)},_getHtml:function(a,b){return a=a.replace(/\{\{([^\}]+)\}\}/g,function(a,c){return b[c]})},_makeDragButton:function(a){a=this._getHtml(a,{"item-id":"item_id_"+this.contentId}),this.$titleElement.append($(a))},_makeToggleButton:function(a){this.$toggleButton=$(a),this.$titleElement.append(this.$toggleButton)},close:function(){this.$toggleButton.addClass("open"),this.$content.hide()},open:function(){this.$toggleButton.removeClass("open"),this.$content.show()},fixTitle:function(){this.showTitle(),this.isTitleFix=!0},showTitle:function(){this.$titleElement.show()},hideTitle:function(){this.isTitleFix||this.$titleElement.hide()},toggle:function(){this.$toggleButton.hasClass("open")?this.open():this.close()},_setEvents:function(){this.$toggleButton.on("click",$.proxy(this.toggle,this))}})}();
//# sourceMappingURL=layout.min.map