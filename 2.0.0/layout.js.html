

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: layout.js | Layout</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 150px; height: 13px">
        
            <a href="https://github.com/nhnent/tui.jsdoc-template" rel="noopener noreferrer" target="_blank">
                <img src="https://cloud.githubusercontent.com/assets/12269563/20029815/01133928-a39a-11e6-80f3-12500a91c755.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Layout</a></h1>
        
            <span class="version">v2.0.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-example01-basic.html">1. Basic</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="example01-basic_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Layout.html">Layout</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Layout_sub"></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Layout component
 * @author NHN Ent. FE dev Lab &lt;dl_javascript@nhnent.com>
 */

'use strict';

var $ = require('jquery');
var snippet = require('tui-code-snippet');

var statics = require('./statics');
var Group = require('./group');
var Guide = require('./guide');

/**
 * Layout class make layout element and include groups, control item move and set events.
 * @class Layout
 * @param {jQuery|HTMLElement|string} container - Wrapper element or id selector
 * @param {object} options
 *     @param {array} options.grouplist - The list of group options.
 *         @param {string} options.grouplist.id - The group id
 *         @param {number} [options.grouplist.ratio] - The group ratio
 *         @param {array} options.grouplist.items - The items that the group includes
 *             @param {string} options.grouplist.items.id - The item id
 *             @param {string} options.grouplist.items.contentId - The content id
 *             @param {string} options.grouplist.items.title - The item's title
 *             @param {string} [options.grouplist.items.isClose] - Whether the item is closed or not
 *             @param {string} [options.grouplist.items.isDraggable] - Whether the item is draggable or not
 * @example
 * var container = document.getElementById('layout');
 * var Layout = tui.Layout; // or require('tui-layout');
 * var instance = new Layout(container, {
 *      grouplist: [{
 *          id: 'g1',
 *          ratio: 50,
 *          items: [{
 *              id: 'item-lifeStyle',
 *              contentId: 'lifeStyle',
 *              title: 'Life Style Seciton',
 *              isClose: false,
 *              isDraggable: true
 *          }, {
 *              id: 'item-calendar',
 *              contentId: 'calendar',
 *              title: 'Calendar Seciton',
 *              isClose: false,
 *              isDraggable: true
 *          }, {
 *              id: 'item-todoList',
 *              contentId: 'todoList',
 *              title: 'TodoList Seciton',
 *              isClose: false,
 *              isDraggable: true
 *         }]
 *     }, {
 *          id: 'g2',
 *          ratio: 50,
 *          items: [{
 *              id: 'item-weather',
 *              contentId: 'weather',
 *              title: 'Weather Seciton',
 *              isClose: false,
 *              isDraggable: true
 *          }, {
 *              id: 'item-news',
 *              contentId: 'news',
 *              title: 'News Seciton',
 *              isClose: true,
 *              isDraggable: true
 *          }]
 *     }]
 * });
 */
var Layout = snippet.defineClass(/** @lends Layout.prototype */ {
    init: function(container, options) {
        /**
         * Container element
         * @type {jQuery}
         * @private
         */
        this.$element = null;

        this._initContainer(container);
        this._makeGroup(options.grouplist);
        this._makeGuide(options.guideHTML);
        this._setEvents();
    },

    /**
     * Initialize container
     * @param {jQuery|Element|string} container - Wrapper element or id selector
     * @private
     */
    _initContainer: function(container) {
        if (snippet.isString(container)) {
            this.$element = $('#' + container);
        } else {
            this.$element = $(container);
        }
    },

    /**
     * Make group
     * @param {Array} grouplist The list of group options
     * @private
     */
    _makeGroup: function(grouplist) {
        var group;

        this.groups = {};

        snippet.forEach(grouplist, function(item) {
            group = this.groups[item.id] = new Group(item);
            this.$element.append(group.$element);
        }, this);
    },

    /**
     * Get group item
     * @param {(string|object)} group The item ID or information to find group
     * @returns {*}
     * @private
     */
    _getGroup: function(group) {
        if (snippet.isObject(group)) {
            if (group.attr('data-group')) {
                group = group.attr('data-group');
            } else {
                group = group.parent().attr('data-group');
            }
        }

        return this.groups[group];
    },

    /**
     * Make guide object
     * @param {string} [guideHTML] guide The html will be usded to make guide element
     * @private
     */
    _makeGuide: function(guideHTML) {
        this._guide = new Guide({
            guideHTML: guideHTML
        });
    },

    /**
     * Set Events
     * @private
     */
    _setEvents: function() {
        this.onMouseDown = $.proxy(this._onMouseDown, this);
        this.onMouseMove = $.proxy(this._onMouseMove, this);
        this.onMouseUp = $.proxy(this._onMouseUp, this);
        $('.drag-item-move').on('mousedown', this.onMouseDown);
    },

    /**
     * Mouse down event handler
     * @param {MouseEvent} e - Event object
     * @private
     */
    _onMouseDown: function(e) {
        var $doc = $(document);
        this.height($doc.height());
        this._setGuide(e.target, e.clientX, e.clientY);
        $doc.on('mousemove', this.onMouseMove);
        $doc.on('mouseup', this.onMouseUp);
    },

    /**
     * Set guide
     * @param {object} target The target to set guide's move-statement element
     * @param {number} pointX The position x to set guide element left.
     * @param {number} pointY The position y to set guide element top.
     * @private
     */
    _setGuide: function(target, pointX, pointY) {
        var $doc = $(document);
        var initPos = {
            x: pointX + $doc.scrollLeft() + 10,
            y: pointY + $doc.scrollTop() + 10
        };
        var itemId = $(target).attr('data-item');
        var $moveEl = $('#' + itemId);

        this._guide.ready(initPos, $moveEl);
        this._guide.setMoveElement($moveEl);
        this.$temp = $moveEl;
        this._lockTemp();
    },

    /**
     * It make item element seems to be locked.
     * @private
     */
    _lockTemp: function() {
        var group = this._getGroup(this.$temp);
        var item = group.list[this.$temp.attr('data-index')];

        this.$temp.css('opacity', '0.2');
        this.$temp.find('#' + item.contentId).css('visibility', 'hidden');
    },

    /**
     * It make item element seems to be unlocked.
     * @private
     */
    _unlockTemp: function() {
        var group = this._getGroup(this.$temp);
        var item = group.list[this.$temp.attr('data-index')];

        this.$temp.css('opacity', '1');
        this.$temp.find('#' + item.contentId).css('visibility', 'visible');
    },

    /**
     * Mouse move handler
     * @param {JqueryEvent} e JqueryEvent object
     * @private
     */
    _onMouseMove: function(e) {
        var parent, $doc, pointX, pointY, group;

        parent = $(e.target).parent();
        $doc = $(document);
        pointX = e.clientX + $doc.scrollLeft();
        pointY = e.clientY + $doc.scrollTop();
        group = parent.attr('data-group');

        this._setScrollState(pointX, pointY);
        this._moveGuide(pointX, pointY);

        if (group) {
            this._detectMove(parent, pointX, pointY);
        }
    },

    /**
     * If element move over area, scroll move to show element
     * @param {number} x - X position
     * @param {number} y - Y position
     * @private
     */
    _setScrollState: function(x, y) {
        var $doc = $(document);
        var $win = $(window);
        var docHeight = this.height();
        var height = $win.height();
        var top = $doc.scrollTop();
        var limit = docHeight - height;

        if (height + top &lt; y) {
            $doc.scrollTop(Math.min(top + (y - height + top), limit));
        }
    },

    /**
     * Save document height or return height
     * @param {number} [height] The height value to save _height feild
     * @returns {number} Current height
     * @ignore
     */
    height: function(height) {
        var result = false;

        if (snippet.isUndefined(height)) {
            result = this._height;
        } else {
            this._height = height;
        }

        return result;
    },

    /**
     * Detect move with group
     * @param {object} item compare position with
     * @param {number} pointX The position x will be detect which element selected.
     * @param {number} pointY The position y will be detect which element selected.
     * @private
     */
    _detectMove: function(item, pointX, pointY) {
        var $doc = $(document);
        var groupInst = this._getGroup(item);
        var top = $doc.scrollTop();
        var left = $doc.scrollLeft();
        var $before;

        if (snippet.isEmpty(groupInst.list)) {
            item.append(this.$temp);
            this.height($doc.height());
            this.$temp.way = 'after';
            this.$temp.index = 0;
        } else {
            $before = this._detectTargetByPosition({
                x: pointX + left,
                y: pointY + top
            }, groupInst);

            if ($before &amp;&amp; $before.way) {
                $before[$before.way](this.$temp);
                this.height($doc.height());
                this.$temp.way = $before.way;
                this.$temp.index = $before.attr('data-index');
            }
        }
    },

    /**
     * Move helper object
     * @param {number} x move position x
     * @param {number} y move position y
     * @private
     */
    _moveGuide: function(x, y) {
        this._guide.moveTo({
            x: x + 10 + 'px',
            y: y + 10 + 'px'
        });
    },

    /**
     * Detect target by move element position
     * @param {object} pos The position to detect
     * @param {object} group The group that has child items
     * @returns {string|*}
     * @private
     */
    _detectTargetByPosition: function(pos, group) {
        var target;

        snippet.forEach(group.list, function(item) {
            if (!this._isValidItem(item)) {
                return;
            }
            target = this._getTarget(item, pos, group) || target;
        }, this);

        return target;
    },

    /**
     * Get target element
     * @param {object} item The item to compare with pos
     * @param {object} pos The pos to figure whether target or not
     * @param {object} group The group has item
     * @returns {jQuery} Target element
     * @private
     */
    _getTarget: function(item, pos, group) {
        var bound = item.$element.offset();
        var bottom = this._getBottom(item, group);
        var height = item.$element.height();
        var top = $(document).scrollTop() + bound.top;
        var $target;

        if (pos.y > top &amp;&amp; pos.y &lt;= top + (height / 2)) {
            $target = item.$element;
            $target.way = 'before';
        } else if (pos.y > top + (height / 2) &amp;&amp; pos.y &lt; bottom) {
            $target = item.$element;
            $target.way = 'after';
        }

        return $target;
    },

    /**
     * Check whether Vaild item or not
     * @param {param} item The item To be compared with temp.
     * @returns {boolean}
     * @private
     */
    _isValidItem: function(item) {
        return (item.$element[0] !== this.$temp[0]);
    },

    /**
     * If next element exist, set bottom next element's top position,
     * else set bottom limit(group element's bottom position) position
     * @param {object} item The object to figure bottom position
     * @param {object} group The group to figure bottom position
     * @returns {*}
     * @private
     */
    _getBottom: function(item, group) {
        var $next = item.$element.next();
        var $doc = $(document);
        var gbound = group.$element.offset();
        var limit = $doc.scrollTop() + gbound.top + group.$element.height();
        var bottom;

        if ($next.hasClass(statics.DIMMED_LAYER_CLASS)) {
            bottom = limit;
        } else {
            bottom = $doc.scrollTop() + $next.offset().top;
        }

        return bottom;
    },

    /**
     * Get add index by $temp, $temp.way
     * @returns {Number}
     * @private
     */
    _getAddIndex: function() {
        var temp = this.$temp,
            index = parseInt(temp.index, 10);
        if (temp.way === 'after') {
            index += 1;
        }

        return index;
    },

    /**
     * Mouse up handler
     * @private
     */
    _onMouseUp: function() {
        var drag = this._guide;
        var $doc = $(document);

        this._update();
        this._unlockTemp();
        drag.finish();

        $doc.off('mousemove', this.onMouseMove);
        $doc.off('mouseup', this.onMouseUp);
    },

    /**
     * Update groups
     * @private
     */
    _update: function() {
        var temp = this.$temp,
            oldGroup = this._getGroup(temp.attr('data-groupInfo')),
            targetGroup = this._getGroup(temp.parent()),
            removeIndex = parseInt(temp.attr('data-index'), 10),
            addIndex = this._getAddIndex(),
            item = oldGroup.list[removeIndex];

        if (!isNaN(addIndex)) {
            oldGroup.storePool();
            targetGroup.storePool();
            oldGroup.remove(removeIndex);
            targetGroup.add(item, addIndex);
            targetGroup.render();
            oldGroup.render();
        }
    }
});

module.exports = Layout;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://cloud.githubusercontent.com/assets/12269563/20029815/01133928-a39a-11e6-80f3-12500a91c755.png" style="width: 150px; height: 13px">
    <div class="footer-text">NHN Entertainment. Frontend Development Lab</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
